# -*- mode: Makefile;-*-
# ##

.PHONY:  install install.alarm-server install.alarm-logger install.alarm-config-logger

reinstall: uninstall install

reinstall.alarm-server: uninstall.alarm-server install.alarm-server

reinstall.alarm-logger: uninstall.alarm-logger install.alarm-logger

reinstall.alarm-config-logger: uninstall.alarm-config-logger install.alarm-config-logger



install: install.alarm-server install.alarm-logger install.alarm-config-logger

install.alarm-server: src_version sd_install.alarm-server
	$(QUIET)$(SUDO) $(INSTALL) -d $(INSTALL_LOCATION_SERVER)
	$(QUIET)$(SUDO) $(INSTALL_DATA) -b $(SITE_TEMPLATE_PATH)/.versions  $(INSTALL_LOCATION_SERVER)/
	$(QUIET)$(SUDO) $(INSTALL) -m 744 $(SRC_PATH_SERVER)/target/service-*.jar  $(INSTALL_SERVER)
	$(QUIET)$(SUDO) cp -rp $(SRC_PATH_SERVER)/target/lib  $(SITE_TEMPLATE_PATH)/$(SERVER_SETTINGS) $(SITE_TEMPLATE_PATH)/$(SERVER_LOGGING_PROPERTIES)  $(INSTALL_LOCATION_SERVER)/

install.alarm-logger: src_version sd_install.alarm-logger
	$(QUIET)$(SUDO) $(INSTALL) -d $(INSTALL_LOCATION_LOGGER)
	$(QUIET)$(SUDO) $(INSTALL_DATA) -b $(SITE_TEMPLATE_PATH)/.versions  $(INSTALL_LOCATION_LOGGER)/
	$(QUIET)$(SUDO) $(INSTALL) -m 744 $(SRC_PATH_LOGGER)/target/service-*.jar  $(INSTALL_LOGGER)
	$(QUIET)$(SUDO) cp -rp $(SITE_TEMPLATE_PATH)/$(LOGGER_PROPERTIES) $(SITE_TEMPLATE_PATH)/$(LOGGER_LOGGING_PROPERTIES)  $(INSTALL_LOCATION_LOGGER)/

install.alarm-config-logger: src_version sd_install.alarm-config-logger 
	$(QUIET)$(SUDO) $(INSTALL) -d $(INSTALL_LOCATION_CONFIGLOGGER)
	$(QUIET)$(SUDO) $(INSTALL_DATA) -b $(SITE_TEMPLATE_PATH)/.versions  $(INSTALL_LOCATION_CONFIGLOGGER)/
	$(QUIET)$(SUDO) $(INSTALL) -m 744 $(SRC_PATH_CONFIGLOGGER)/target/service-*.jar  $(INSTALL_CONFIGLOGGER)
	$(QUIET)$(SUDO) cp -rp $(SITE_TEMPLATE_PATH)/$(CONFIGLOGGER_PROPERTIES) $(SITE_TEMPLATE_PATH)/$(CONFIGLOGGER_LOGGING_PROPERTIES)  $(INSTALL_LOCATION_CONFIGLOGGER)/

.PHONY: uninstall uninstall.alarm-server uninstall.alarm-logger uninstall.alarm-config-logger


uninstall: uninstall.alarm-server uninstall.alarm-logger uninstall.alarm-config-logger


uninstall.alarm-server: sd_stop.alarm-server sd_disable.alarm-server sd_remove.alarm-server
	$(QUIET)echo "Removing $(INSTALL_LOCATION_SERVER)..."
	$(QUIET)$(SUDO) rm -rf $(INSTALL_LOCATION_SERVER)


uninstall.alarm-logger: sd_stop.alarm-logger sd_disable.alarm-logger sd_remove.alarm-logger
	$(QUIET)echo "Removing $(INSTALL_LOCATION_LOGGER)..."
	$(QUIET)$(SUDO) rm -rf $(INSTALL_LOCATION_LOGGER)

uninstall.alarm-config-logger: sd_stop.alarm-config-logger sd_disable.alarm-config-logger sd_remove.alarm-config-logger
	$(QUIET)echo "Removing $(INSTALL_LOCATION_CONFIGLOGGER)..."
	$(QUIET)$(SUDO) rm -rf $(INSTALL_LOCATION_CONFIGLOGGER)


.PHONY: src_version
src_version: FORCE
	$(QUIET)echo "Timestamps : $$(date +%Y%m%d-%H%M%S)/YYYYMMDD-HHMMSS" > $(SITE_TEMPLATE_PATH)/.versions
	$(QUIET)echo "- SRC URL : $(SRC_GITURL)"  >> $(SITE_TEMPLATE_PATH)/.versions
	$(QUIET)echo "- SRC VER : $(SRC_TAG)"     >> $(SITE_TEMPLATE_PATH)/.versions

clean:
	rm -rf $(SITE_TEMPLATE_PATH)/.versions
FORCE:


